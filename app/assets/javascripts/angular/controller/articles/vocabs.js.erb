app.controller('VocabsCtrl', ['$scope', '$http', '$location', function($scope, $http, $location) {

  var url = "<%= ENV['URL'] %>" || "http://localhost:3000";

  $scope.form = {};
  $scope.newVocab = {};
  $scope.vocabsArr = [];

  // Get all the vocabs from the backend
  $http.get(url + '/vocabs').success(function(response){
    $scope.vocabsArr = response;
  });

  // when click in the form to add, push to backend
  // if ok, push into vocabsArr
  $scope.form.create = function(){

    var data = { vocab: $scope.newVocab };

    if ($scope.newVocab.id) {
      $http.patch(url + '/vocabs/' + $scope.newVocab.id, data).success(function(response){
        console.log(response);
        $scope.newVocab = {};
      });

    } else {
      $http.post(url + '/vocabs', data).success(function(response){
        console.log(response);
        $scope.vocabsArr.push($scope.newVocab);
        $scope.newVocab = {};
      });
    }
  };

  $scope.delete = function(arrayIndex, vocabId) {
    $http.delete(url + '/vocabs/' + vocabId).success(function(response) {
      console.log(response);
      $scope.vocabsArr.splice(arrayIndex, 1);
    });
  };

  $scope.edit = function(arrayIndex) {
    $scope.newVocab = $scope.vocabsArr[arrayIndex];
  };

  // var response = {
  //   "message": "曾协助特首梁振英竞选的行会前成员张震远，继其经营的商交所被清盘、个人被颁令破产后，早前因拖欠前商交所"
  // }

  $scope.article = function(){

  var data = $scope.newArticle.chinese;

  //pinyin2
   $http.get(url + '/segment1?chinese=' + data).success(function(response){
    console.log(response.message);
    $scope.translated = response["message"];
   })

   //if the checkbox is checked toggle between simplified and traditional
    if ($scope.checkboxModel.value1 === true) {
      console.log(data);
      $http.get(url + '/tradsim?chinese=' + data).success(function(response){
        console.log(response.message);
        $scope.translated = response["message"];
      })
    }
  };

   $scope.checkboxModel = {
       value1 : true,
       value2 : 'YES'
     };

}])
